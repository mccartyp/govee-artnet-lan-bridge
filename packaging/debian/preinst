#!/bin/bash
set -e

case "$1" in
    install|upgrade)
        # Create virtual environment for isolated Python dependencies
        echo "Creating Python virtual environment..."
        python3 -m venv /opt/govee-bridge/venv || true

        # Install pydantic v2 and other dependencies in venv
        if [ -f /opt/govee-bridge/venv/bin/pip ]; then
            echo "Installing Python dependencies in venv..."
            /opt/govee-bridge/venv/bin/pip install --quiet \
                'pydantic>=2.0.0' \
                'fastapi>=0.101.0' \
                'httpx>=0.26.0' \
                'uvicorn>=0.23.0' \
                'prometheus-client>=0.20.0' \
                'PyYAML>=6.0.0' \
                'rich>=13.0.0' \
                || true
        fi
        ;;
esac

exit 0
